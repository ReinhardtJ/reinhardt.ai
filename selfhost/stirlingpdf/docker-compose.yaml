services:
  stirling-pdf:
    image: docker.stirlingpdf.com/stirlingtools/stirling-pdf:1.0.0
    container_name: stirling-pdf
    volumes:
      - ./StirlingPDF/trainingData:/usr/share/tessdata # Required for extra OCR languages
      - ./StirlingPDF/extraConfigs:/configs
      - ./StirlingPDF/customFiles:/customFiles/
      - ./StirlingPDF/logs:/logs/
      - ./StirlingPDF/pipeline:/pipeline/
    environment:
      - DOCKER_ENABLE_SECURITY=false
      - LANGS=en_GB
    network_mode: service:stirling-pdf-ts
    restart: on-failure:10
    depends_on:
      - stirling-pdf-ts
    logging:
      options:
        max-size: "50m"  

  stirling-pdf-ts:
    image: tailscale/tailscale:latest
    container_name: stirling-pdf-ts
    hostname: stirling-pdf
    environment:
      - TS_AUTHKEY
      - TS_STATE_DIR=/var/lib/tailscale
      - TS_USERSPACE=false
    volumes:
      - ./ts-data/stirling-pdf:/var/lib/tailscale
    devices:
      - /dev/net/tun:/dev/net/tun
    cap_add:
      - NET_ADMIN
    restart: on-failure:10
    networks:
      - stirling_pdf_net
    logging:
      options:
        max-size: "50m"

networks:
  stirling_pdf_net:
    driver: bridge

